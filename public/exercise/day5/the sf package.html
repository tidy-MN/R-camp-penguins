

<div id="spatial-analysis-with-r" class="section level2">
<h2>Spatial analysis with R</h2>
<p>A major powertool in R for spatial analysis and geograpy data processing is the <em>sf</em> package.</p>
<div class="float">
<img src="https://user-images.githubusercontent.com/520851/34849243-0972e474-f722-11e7-9a3d-2d4bf5075835.png" alt="https://gist.github.com/edzer/f461a3a95570c4ab7edf3125c2f19d20" />
<div class="figcaption"><a href="https://gist.github.com/edzer/f461a3a95570c4ab7edf3125c2f19d20" class="uri">https://gist.github.com/edzer/f461a3a95570c4ab7edf3125c2f19d20</a></div>
</div>
<div id="reading-in-data" class="section level3">
<h3>Reading in data</h3>
<p>The main type of data you will be reading in are <a href="https://en.wikipedia.org/wiki/Shapefile">shapefiles</a>. Shapefiles are not one file, but are actually a set of files that include the data, the attributes of the coordinates, the projection, the coordinates, and information that tells the software the type of data it is.</p>
<p>Let’s pull in some point tree data from San Francisco and play with it a bit.</p>
<p>Now, let’s look at the data</p>
<p>You can see that there are latitude and longitude columns, but R does not yet know that this is a geographic dataset.</p>
<p>We get an error for missing coordinates, so let’s get rid of the missing coordinates.</p>
<p>We can check that the data set is a geographic dataset by looking at a plot of the data.</p>
<p>Looks like there are some trees in the wrong spot. So, let’s look at which trees intersect with the City of San Francisco shapefile. We will read in the shapefile and then run an intersection.</p>
<p>Buffers
Geom_sf</p>
<pre class="r"><code>library(tigris)

city_shape &lt;- st_read(&quot;https://data.sfgov.org/api/geospatial/pdvd-w2q4?method=export&amp;format=Shapefile&quot;)

cities &lt;- metro_divisions()

san_fran &lt;- filter(cities, grepl(&quot;San Francisco&quot;, NAME))

st_crs(san_fran)

trees_in_san_fran &lt;- st_intersection(sf_trees_geo, san_fran)</code></pre>
<p>Now let’s draw a buffer around each tree that remains inside the boundary of San Francisco proper. To draw a buffer we need to make sure the coordinates are correct. Remember when we talked about coordinate reference systems? Universal tranverse mercator, or UTMs have coordinates in meters. San Francisco is in UTM zone 10.</p>
<pre class="r"><code>trees_in_san_fran &lt;- st_transform(trees_in_san_fran, crs = 32610)
trees_in_san_fran &lt;- st_buffer(trees_in_san_fran, dist = 1000)</code></pre>
<p>Finally, let’s see which tree is the farthest distance from a loon in Leech Lake, Minnesota.</p>
<pre class="r"><code>leech_lake_center_lat &lt;- 47.162382 
leech_lake_center_long &lt;- -94.428769

coords &lt;- c(leech_lake_center_long, leech_lake_center_lat)

leech_lake_mn &lt;- st_sfc(st_point(coords))

leech_lake_mn &lt;- st_as_sf(leech_lake_mn, crs = 9822)

trees_in_san_fran &lt;- st_transform(trees_in_san_fran, crs = 9822)
trees_in_san_fran_center &lt;- st_centroid(trees_in_san_fran)

distance_to_loons &lt;- st_distance(leech_lake_mn, trees_in_san_fran_center)</code></pre>
</div>
</div>
